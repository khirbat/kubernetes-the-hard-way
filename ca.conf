# For more information on the format of this file, see:
# https://docs.openssl.org/master/man5/x509v3_config/

[req]
distinguished_name = req_distinguished_name
prompt             = no
x509_extensions    = ca_x509_extensions
utf8               = yes

[ca_x509_extensions]
basicConstraints = CA:TRUE
keyUsage         = cRLSign, keyCertSign

[req_distinguished_name]
C   = US
ST  = California
L   = San Jose
CN  = ‚ò∏Ô∏è CA üîëüîí

[admin]
distinguished_name = admin_distinguished_name
prompt             = no

[admin_distinguished_name]
CN = admin
O  = system:masters

[admin_ext]
extendedKeyUsage     = clientAuth
keyUsage             = critical, digitalSignature, keyEncipherment

# Service Accounts
#
# The Kubernetes Controller Manager uses a key pair to generate and sign service account tokens.
# See [Managing Service Accounts](https://kubernetes.io/docs/reference/access-authn-authz/service-accounts-admin/)

[service-accounts]
distinguished_name = service-accounts_distinguished_name
prompt             = no

[service-accounts_distinguished_name]
CN = service-accounts

[service-accounts_ext]
extendedKeyUsage     = clientAuth
keyUsage             = critical, digitalSignature, keyEncipherment

# Worker Nodes
#
# Kubernetes uses [Node Authorization](https://kubernetes.io/docs/reference/access-authn-authz/node/)
# to authorize API requests made by [Kubelets](https://kubernetes.io/docs/concepts/architecture/#kubelet).
# In order to be authorized by the Node Authorizer, Kubelets must use a credential that identifies them as
# being in the `system:nodes` group, with a username of `system:node:<nodeName>`.

[node-0]
distinguished_name = node-0_distinguished_name
prompt             = no

[node-0_ext]
extendedKeyUsage     = clientAuth, serverAuth
keyUsage             = critical, digitalSignature, keyEncipherment
subjectAltName       = DNS:node-0, IP:127.0.0.1

[node-0_distinguished_name]
CN = system:node:node-0
O  = system:nodes
C  = US
ST = California
L  = San Jose

[node-1]
distinguished_name = node-1_distinguished_name
prompt             = no

[node-1_ext]
extendedKeyUsage     = clientAuth, serverAuth
keyUsage             = critical, digitalSignature, keyEncipherment
subjectAltName       = DNS:node-1, IP:127.0.0.1

[node-1_distinguished_name]
CN = system:node:node-1
O  = system:nodes
C  = US
ST = California
L  = San Jose


# Kube Proxy Section
[kube-proxy]
distinguished_name = kube-proxy_distinguished_name
prompt             = no

[kube-proxy_ext]
extendedKeyUsage     = clientAuth, serverAuth
keyUsage             = critical, digitalSignature, keyEncipherment
subjectAltName       = DNS:kube-proxy, IP:127.0.0.1

[kube-proxy_distinguished_name]
CN = system:kube-proxy
O  = system:node-proxier
C  = US
ST = California
L  = San Jose


# Controller Manager
[kube-controller-manager]
distinguished_name = kube-controller-manager_distinguished_name
prompt             = no

[kube-controller-manager_ext]
extendedKeyUsage     = clientAuth, serverAuth
keyUsage             = critical, digitalSignature, keyEncipherment
subjectAltName       = DNS:kube-controller-manager, IP:127.0.0.1

[kube-controller-manager_distinguished_name]
CN = system:kube-controller-manager
O  = system:kube-controller-manager
C  = US
ST = California
L  = San Jose


# Scheduler
[kube-scheduler]
distinguished_name = kube-scheduler_distinguished_name
prompt             = no

[kube-scheduler_ext]
extendedKeyUsage     = clientAuth, serverAuth
keyUsage             = critical, digitalSignature, keyEncipherment
subjectAltName       = DNS:kube-scheduler, IP:127.0.0.1

[kube-scheduler_distinguished_name]
CN = system:kube-scheduler
O  = system:system:kube-scheduler
C  = US
ST = California
L  = San Jose


# API Server
#
# The Kubernetes API server is automatically assigned the `kubernetes`
# internal DNS name, which will be linked to the first IP address (`10.32.0.1`)
# from the address range (`10.32.0.0/24`) reserved for internal cluster
# services.

[kube-apiserver]
distinguished_name = kube-apiserver_distinguished_name
prompt             = no

[kube-apiserver_ext]
extendedKeyUsage     = clientAuth, serverAuth
keyUsage             = critical, digitalSignature, keyEncipherment
subjectAltName       = @kube-apiserver_alt_names

[kube-apiserver_alt_names]
IP.0  = 127.0.0.1
IP.1  = 10.32.0.1
DNS.0 = kubernetes
DNS.1 = kubernetes.default
DNS.2 = kubernetes.default.svc
DNS.3 = kubernetes.default.svc.cluster
DNS.4 = kubernetes.svc.cluster.local
DNS.5 = server

[kube-apiserver_distinguished_name]
CN = kubernetes
C  = US
ST = California
L  = San Jose
